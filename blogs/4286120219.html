<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="google-site-verification" content="I-NYDDDjiAX8GQEQ_lE0inL4AJtjz4z-HyL122q_swc">
    <meta name="baidu-site-verification" content="ZeyYBV52u1">
    <meta name="keywords" content="FastDFS-Nginx分布式文件系统搭建, chihiro">
    <meta name="description" content="因为不想把博客的图片放在别人的图床上，所以自己研究了个图片服务器。本人搭建的为单机方案，当然此服务器自带集群方案，只是博主没有配置。有需要集群配置方案的也很简单，改几个配置就可以了。具体集群步骤可以问问度娘。首先感谢牧佑大佬的试错总结，没有">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="keywords" content="{{ page.keywords }}">
    <meta name="keywords" content="{% for tag in page.tags %}{{ tag.name }},{% endfor %}">
    <meta name="keywords" content="{{ theme.keywords }}">

    <title>FastDFS-Nginx分布式文件系统搭建 | 千与千寻</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
        code[class*="language-"], pre[class*="language-"] {
            white-space: pre !important;
        }
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script src="https://v1.hitokoto.cn/?c=d&encode=js&select=%23hitokoto" defer></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">千与千寻</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">千与千寻</div>
        <div class="logo-desc">
            
            太阳照常升起，黑暗继续隐匿，直至被白日忘记，一切歌舞升平。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/QianXun0827" class="waves-effect waves-light" target="_blank" rel="external nofollow noopener noreferrer">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/QianXun0827" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50" rel="external nofollow noopener noreferrer">
    <svg viewbox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
    </svg>
</a>
        
    </nav>

</header>


<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://s2.ax1x.com/2019/04/04/A2D1gO.png')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        FastDFS-Nginx分布式文件系统搭建
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/FastDFS/" target="_blank">
                                <span class="chip bg-color">FastDFS</span>
                            </a>
                        
                            <a href="/tags/Nginx/" target="_blank">
                                <span class="chip bg-color">Nginx</span>
                            </a>
                        
                            <a href="/tags/分布式文件系统/" target="_blank">
                                <span class="chip bg-color">分布式文件系统</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/服务器/" class="post-category" target="_blank">
                                服务器
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2019-04-04
                </div>

		
                    <div class="info-break-policy">
                        <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                        chihiro
                    </div>
                    

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        4,143
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        19 分
                    </div>
                    
                
				
				
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>因为不想把博客的图片放在别人的图床上，所以自己研究了个图片服务器。本人搭建的为单机方案，当然此服务器自带集群方案，只是博主没有配置。有需要集群配置方案的也很简单，改几个配置就可以了。具体集群步骤可以问问度娘。首先感谢<a href="https://blog.csdn.net/qq_34301871/article/details/80060235" rel="external nofollow noopener noreferrer" target="_blank">牧佑</a>大佬的试错总结，没有他的总结，我也写不出来这篇博客，当然我也出现了不少未知错误。话不多说，直接开始！</p>
<blockquote>
<p>首先声明：本文不介绍Nginx和FastDfs的来源及应用场景，文中出现的<code>120.\*\*.\*\*\*.165</code>地址为博主服务器ip地址，实际搭建时请更改为自己的ip！<br>fastdfs 5.11 版本对照：Version 5.11对应的fastdfs-nginx-module的Version 1.20<br>fastdfs 5.10 版本对照：Version 5.10对应的fastdfs-nginx-module的Version 1.19<br>** 如果版本不对应，后期安装会报错！！！*\*</p>
</blockquote>
<h2 id="安装FastDfs"><a href="#安装FastDfs" class="headerlink" title="安装FastDfs"></a>安装FastDfs</h2><p>作者的GitHub地址：<a href="https://github.com/happyfish100" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/happyfish100</a>（本次所需的工具大部分都可以找到）<br>首先搭建需要用到的所有工具截图<br><img src="https://s2.ax1x.com/2019/04/04/A23d6P.png" alt=""></p>
<h2 id="在此直接公布下载地址，毕竟时间宝贵！"><a href="#在此直接公布下载地址，毕竟时间宝贵！" class="headerlink" title="在此直接公布下载地址，毕竟时间宝贵！"></a>在此直接公布下载地址，毕竟时间宝贵！</h2><ul>
<li><strong>fastdfs 5.11</strong>  点击如下图即可，完成下载。<br><a href="https://github.com/happyfish100/fastdfs/releases" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/happyfish100/fastdfs/releases</a><br><img src="https://s2.ax1x.com/2019/04/04/A28Khj.png" alt=""></li>
</ul>
<hr>
<ul>
<li><strong>fastdfs-client-java-master</strong> 点击如下图即可，完成下载。<br><a href="https://github.com/happyfish100/fastdfs-client-java" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/happyfish100/fastdfs-client-java</a><br><img src="https://s2.ax1x.com/2019/04/04/A28Bg1.png" alt=""></li>
</ul>
<hr>
<ul>
<li><strong>fastdfs-nginx-module-master</strong> 点击如下图即可，完成下载。<br><a href="https://github.com/happyfish100/fastdfs-nginx-module" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/happyfish100/fastdfs-nginx-module</a><br><img src="https://s2.ax1x.com/2019/04/04/A28gED.png" alt=""></li>
</ul>
<hr>
<ul>
<li><strong>libfastcommon-master</strong> 点击如下图即可，完成下载。<br><a href="https://github.com/happyfish100/libfastcommon" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/happyfish100/libfastcommon  </a><br><img src="https://s2.ax1x.com/2019/06/24/ZAUlwQ.png" alt=""></li>
</ul>
<hr>
<ul>
<li><strong>nginx-1.12.0.tar</strong> 点击如下图即可，完成下载。<br><a href="http://nginx.org/download/" rel="external nofollow noopener noreferrer" target="_blank">http://nginx.org/download/</a><br><img src="https://s2.ax1x.com/2019/04/04/A282Ue.png" alt=""></li>
</ul>
<hr>
<p>到此，所需要的工具已经下载完毕。<br>下面开始搭建，博主使用的是阿里云轻量级服务器下的linux系统，下面的工具运行命令可看情况安装，但实际安装后已存在的工具不会重复安装，所以完全可以直接复制过去执行一遍，以防万一。<br>首先下载 所需全部工具运行命令</p>
<pre class=" language-bash"><code class="language-bash">yum -y <span class="token function">install</span> zlib zlib-devel pcre pcre-devel gcc gcc-c++ openssl openssl-devel libevent libevent-devel perl unzip net-tools <span class="token function">wget</span>
</code></pre>
<p>等待下载完成 然后安装rz 命令</p>
<pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> lrzsz -y
</code></pre>
<p>通过rz命令 或者sftp上传到/home目录下自己新建一个目录（根据个人习惯）<br><code>cd /var</code> 进入var目录<br><code>mkdir fdfs</code> 创建fdfs文件夹<br><code>cd fdfs</code> 进入fdfs文件夹<br><code>rz</code>(或直接将文件拖拽进shell窗口) 将下载好的文件传输至服务器<br><code>ls</code> 如下图所示5个压缩文件<br><img src="https://s2.ax1x.com/2019/04/04/A2GQaD.png" alt=""></p>
<h3 id="安装libfastcommon"><a href="#安装libfastcommon" class="headerlink" title="安装libfastcommon"></a>安装libfastcommon</h3><p>解压刚才上传的文件，然后进入解压完成的文件目录<br><code>unzip libfastcommon-master.zip</code> 解压libfastcommon-master<br><code>cd libfastcommon-master</code>  进入libfastcommon-master<br><code>ll</code><br>我们会看到<br><img src="https://s2.ax1x.com/2019/04/04/A2GNsP.png" alt=""><br>开始安装 执行</p>
<pre class=" language-bash"><code class="language-bash">./make.sh
./make.sh <span class="token function">install</span>
</code></pre>
<p>看看有没有报错，如果没有错误就可以执行软链接了。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">ln</span> -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so 
<span class="token function">ln</span> -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so 
<span class="token function">ln</span> -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so
<span class="token function">ln</span> -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so
</code></pre>
<h3 id="安装FastDfs-1"><a href="#安装FastDfs-1" class="headerlink" title="安装FastDfs"></a>安装FastDfs</h3><p>然后回到/var/fdfs(或者你创建的文件下)<br>解压fastdfs<br><code>unzip fastdfs-5.11.zip</code><br>解压完成进入fastdfs5.11</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> fastdfs-5.11 
./make.sh
./make.sh <span class="token function">install</span>
</code></pre>
<p>如果没有报错那么，万里长征第一步已经成功，如果报错，请根据报错提示重装。<br>成功之后查看目录</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /etc/fdfs/  </span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll  </span>
-rw-r--r-- 1 root root  1461 Jun  8 21:56 client.conf.sample  
-rw-r--r-- 1 root root  7927 Jun  8 21:56 storage.conf.sample  
-rw-r--r-- 1 root root  7389 Jun  8 21:56 tracker.conf.sample  
</code></pre>
<p>我们需要把这三个实例文件服务一份，去掉sample</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cp</span> client.conf.sample client.conf
<span class="token function">cp</span> storage.conf.sample storage.conf
<span class="token function">cp</span> tracker.conf.sample tracker.conf
</code></pre>
<p>到此~FastDFS安装结束。</p>
<h3 id="安装tracker"><a href="#安装tracker" class="headerlink" title="安装tracker"></a>安装tracker</h3><p>创建tarcker工作目录<br>这个目录可以自定义，用来保存tracker的data和log<br>根据个人习惯创建下面的目录：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz var<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir fastdfs</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz var<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd fastdfs/</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir fastdfs_tracker</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd fastdfs_tracker/</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs_tracker<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># pwd</span>
/var/fastdfs/fastdfs_tracker        <span class="token comment" spellcheck="true">#这个是我最终创建的目录</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs_tracker<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>
</code></pre>
<p>配置tracker</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /etc/fdfs
vim tracker.conf
</code></pre>
<p>打开后找到下面4处然后修改即可（点点111）</p>
<pre class=" language-bash"><code class="language-bash">1. disabled<span class="token operator">=</span>false <span class="token comment" spellcheck="true">#默认开启 </span>
2. port<span class="token operator">=</span>22122 <span class="token comment" spellcheck="true">#默认端口号 </span>
3. base_path<span class="token operator">=</span>/var/fastdfs/fastdfs_tracker <span class="token comment" spellcheck="true">#刚刚创建的目录 </span>
4. http.server_port<span class="token operator">=</span>6666 <span class="token comment" spellcheck="true">#默认端口是8080</span>
</code></pre>
<p>保存修改文件<br>启动 tracker 命令如下。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">service</span> fdfs_trackerd start
</code></pre>
<p>如果不能成功启动，可以通systemctl命令</p>
<pre class=" language-bash"><code class="language-bash">systemctl start fdfs_trackerd
</code></pre>
<p>成功之后可以看见</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service fdfs_trackerd start</span>
Starting fdfs_trackerd <span class="token punctuation">(</span>via systemctl<span class="token punctuation">)</span>:                    <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
</code></pre>
<p>进入 （点点111） 创建的tracker目录。发现目录多了data和log两个目录</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/fastdfs/fastdfs_tracker/</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs_tracker<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll</span>
total 0
drwxr-xr-x 2 root root 178 Jun 16 21:19 data
drwxr-xr-x 2 root root  26 Jun 13 22:01 logs
</code></pre>
<p>然后 我们不能每次都这么启动tracker，我们需要给tracker加入开机启动<br>首先需要给执行权限，</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">chmod</span> +x /etc/rc.d/rc.local
</code></pre>
<p>然后开始修改rc.local</p>
<pre class=" language-bash"><code class="language-bash">vim /etc/rc.d/rc.local
</code></pre>
<p>在配置文件最后加下最后一句话即可</p>
<pre class=" language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token comment" spellcheck="true"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># It is highly advisable to create own systemd services or udev rules</span>
<span class="token comment" spellcheck="true"># to run scripts during boot instead of using this file.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># In contrast to previous versions due to parallel execution during boot</span>
<span class="token comment" spellcheck="true"># this script will NOT be run after all other services.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span>
<span class="token comment" spellcheck="true"># that this script will be executed during boot.</span>

<span class="token function">touch</span> /var/lock/subsys/local
<span class="token function">service</span> fdfs_trackerd start
</code></pre>
<p>保存，然后 查看tracker端口监听情况</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs_tracker<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># netstat -unltp|grep fdfs</span>
tcp        0      0 0.0.0.0:22122           0.0.0.0:*               LISTEN      2233/fdfs_trackerd
</code></pre>
<p>到此22122端口监听成功。</p>
<h3 id="安装storage"><a href="#安装storage" class="headerlink" title="安装storage"></a>安装storage</h3><p>为storage配置工作目录，由于storage还需要一个目录用来存储数据，所以我另外多建了一个fastdfs_storage_data </p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
fastdfs_storage  fastdfs_storage_data  fastdfs_tracker
</code></pre>
<p>修改storage配置文件<br>修改storage.conf</p>
<pre class=" language-bash"><code class="language-bash">vim /etc/fdfs/storage.conf
</code></pre>
<p>找到如下几处地方修改即可</p>
<pre class=" language-bash"><code class="language-bash">1. disabled<span class="token operator">=</span>false 
2. group_name<span class="token operator">=</span>group1 <span class="token comment" spellcheck="true">#组名，根据实际情况修改 </span>
3. port<span class="token operator">=</span>23000  <span class="token comment" spellcheck="true">#设置storage的端口号，默认是23000，同一个组的storage端口号必须一致 </span>
4. base_path<span class="token operator">=</span>/var/fastdfs/fastdfs_storage  <span class="token comment" spellcheck="true">#设置storage数据文件和日志目录 </span>
5. store_path_count<span class="token operator">=</span>1 <span class="token comment" spellcheck="true">#存储路径个数，需要和store_path个数匹配 </span>
6. store_path0<span class="token operator">=</span>/var/fastdfs/fastdfs_storage_data <span class="token comment" spellcheck="true">#实际文件存储路径 </span>
7. tracker_server<span class="token operator">=</span>120.**.***.165:22122 <span class="token comment" spellcheck="true">#我CentOS7的ip地址 </span>
8. http.server_port<span class="token operator">=</span>8888 <span class="token comment" spellcheck="true">#设置 http 端口号</span>
</code></pre>
<p>保存之后 创建软引用</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">ln</span> -s /usr/bin/fdfs_storaged /usr/local/bin
</code></pre>
<p>启动storage</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">service</span> fdfs_storaged start
</code></pre>
<p>同理 如果不能启动可以用下述命令</p>
<pre class=" language-bash"><code class="language-bash">systemctl start fdfs_storaged
</code></pre>
<p>成功应该是如下</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service fdfs_stroaged start</span>
Starting fdfs_storaged <span class="token punctuation">(</span>via systemctl<span class="token punctuation">)</span>:                    <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
</code></pre>
<p>同样设置开机启动<br>修改rc.local</p>
<pre class=" language-bash"><code class="language-bash">vim /etc/rc.d/rc.local

<span class="token comment" spellcheck="true">#!/bin/bash</span>
<span class="token comment" spellcheck="true"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># It is highly advisable to create own systemd services or udev rules</span>
<span class="token comment" spellcheck="true"># to run scripts during boot instead of using this file.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># In contrast to previous versions due to parallel execution during boot</span>
<span class="token comment" spellcheck="true"># this script will NOT be run after all other services.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span>
<span class="token comment" spellcheck="true"># that this script will be executed during boot.</span>

<span class="token function">touch</span> /var/lock/subsys/local
<span class="token function">service</span> fdfs_trackerd start
<span class="token function">service</span> fdfs_storaged start
</code></pre>
<p>同样查看服务是否启动</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz fastdfs<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># netstat -unltp | grep fdfs</span>
tcp        0      0 0.0.0.0:22122           0.0.0.0:*               LISTEN      2233/fdfs_trackerd
tcp        0      0 0.0.0.0:23000           0.0.0.0:*               LISTEN      2323/fdfs_storaged
</code></pre>
<p>服务启动，到此fastdfs已经配置完成了。最后我们再确认一下，storage是否注册到了tracker中去。 </p>
<pre class=" language-bash"><code class="language-bash">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf
</code></pre>
<p>成功后可以看到： </p>
<pre class=" language-bash"><code class="language-bash">ip_addr <span class="token operator">=</span> 120.**.***.165 <span class="token punctuation">(</span>localhost.localdomain<span class="token punctuation">)</span> ACTIVE 的字样
</code></pre>
<p>ok，修改客户端配置文件</p>
<pre class=" language-bash"><code class="language-bash">vim /etc/fdfs/client.conf

base_path<span class="token operator">=</span>/var/fastdfs/fastdfs_tracker <span class="token comment" spellcheck="true">#tracker服务器文件路径</span>
tracker_server<span class="token operator">=</span>120.**.***.165:22122 <span class="token comment" spellcheck="true">#tracker服务器IP地址和端口号</span>
http.tracker_server_port<span class="token operator">=</span>6666 <span class="token comment" spellcheck="true"># tracker 服务器的 http端口号，必须和tracker的设置对应起来</span>
</code></pre>
<p>接下来上传图片到centos7为测试<br>rz 命令选择一张照片 上传到随便一个目录但是 一定要复制出来<br>接下来</p>
<pre class=" language-bash"><code class="language-bash">/usr/bin/fdfs_upload_file  /etc/fdfs/client.conf  /root/测试.jpg  <span class="token comment" spellcheck="true">#你上传的图片路径（linux上的）</span>
</code></pre>
<p>成功之后会返回图片的路径</p>
<pre class=" language-bash"><code class="language-bash">group1/M00/00/00/rBEcC1ykgdiALaceAACZsuwCbKE956.jpg
</code></pre>
<p>我们去刚才上传的路径查看是否上传成功</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /var/fastdfs/fastdfs_storage_data/data

<span class="token function">ls</span>

0  0D  1A  27  34  41  4E  5B  68  75  82  8F  9C  A9  B6  C3  D0  DD  EA  F7
01  0E  1B  28  35  42  4F  5C  69  76  83  90  9D  AA  B7  C4  D1  DE  EB  F8
02  0F  1C  29  36  43  50  5D  6A  77  84  91  9E  AB  B8  C5  D2  DF  EC  F9
03  10  1D  2A  37  44  51  5E  6B  78  85  92  9F  AC  B9  C6  D3  E0  ED  FA
04  11  1E  2B  38  45  52  5F  6C  79  86  93  A0  AD  BA  C7  D4  E1  EE  FB
05  12  1F  2C  39  46  53  60  6D  7A  87  94  A1  AE  BB  C8  D5  E2  EF  FC
06  13  20  2D  3A  47  54  61  6E  7B  88  95  A2  AF  BC  C9  D6  E3  F0  FD
07  14  21  2E  3B  48  55  62  6F  7C  89  96  A3  B0  BD  CA  D7  E4  F1  FE
08  15  22  2F  3C  49  56  63  70  7D  8A  97  A4  B1  BE  CB  D8  E5  F2  FF
09  16  23  30  3D  4A  57  64  71  7E  8B  98  A5  B2  BF  CC  D9  E6  F3  M00
0A  17  24  31  3E  4B  58  65  72  7F  8C  99  A6  B3  C0  CD  DA  E7  F4
0B  18  25  32  3F  4C  59  66  73  80  8D  9A  A7  B4  C1  CE  DB  E8  F5
0C  19  26  33  40  4D  5A  67  74  81  8E  9B  A8  B5  C2  CF  DC  E9  F6
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz data<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd 00</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz 00<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
00  0D  1A  27  34  41  4E  5B  68  75  82  8F  9C  A9  B6  C3  D0  DD  EA  F7
01  0E  1B  28  35  42  4F  5C  69  76  83  90  9D  AA  B7  C4  D1  DE  EB  F8
02  0F  1C  29  36  43  50  5D  6A  77  84  91  9E  AB  B8  C5  D2  DF  EC  F9
03  10  1D  2A  37  44  51  5E  6B  78  85  92  9F  AC  B9  C6  D3  E0  ED  FA
04  11  1E  2B  38  45  52  5F  6C  79  86  93  A0  AD  BA  C7  D4  E1  EE  FB
05  12  1F  2C  39  46  53  60  6D  7A  87  94  A1  AE  BB  C8  D5  E2  EF  FC
06  13  20  2D  3A  47  54  61  6E  7B  88  95  A2  AF  BC  C9  D6  E3  F0  FD
07  14  21  2E  3B  48  55  62  6F  7C  89  96  A3  B0  BD  CA  D7  E4  F1  FE
08  15  22  2F  3C  49  56  63  70  7D  8A  97  A4  B1  BE  CB  D8  E5  F2  FF
09  16  23  30  3D  4A  57  64  71  7E  8B  98  A5  B2  BF  CC  D9  E6  F3
0A  17  24  31  3E  4B  58  65  72  7F  8C  99  A6  B3  C0  CD  DA  E7  F4
0B  18  25  32  3F  4C  59  66  73  80  8D  9A  A7  B4  C1  CE  DB  E8  F5
0C  19  26  33  40  4D  5A  67  74  81  8E  9B  A8  B5  C2  CF  DC  E9  F6
<span class="token punctuation">[</span>root@localhost 00<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd 00</span>
<span class="token punctuation">[</span>root@localhost 00<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>

rBEcC1ykgdiALaceAACZsuwCbKE956.jpg 
</code></pre>
<p>果然我们找到了图片了。<br>data下有256个1级目录，每级目录下又有256个2级子目录，总共65536个文件，新写的文件会以hash的方式被路由到其中某个子目录下，然后将文件数据直接作为一个本地文件存储到该目录中。<br>然后我们HTTP访问文件<br><a href="http://120.**.**.165:9999/group1/M00/00/00/rBEcC1ykgdiALaceAACZsuwCbKE956.jpg" rel="external nofollow noopener noreferrer" target="_blank">http://120.**.**.165:9999/group1/M00/00/00/rBEcC1ykgdiALaceAACZsuwCbKE956.jpg</a><br><img src="https://s2.ax1x.com/2019/04/04/A2YbVK.png" alt=""><br>我们发现，http不能直接访问到图片。这是为什么呢。<br>原来早在4.05的时候，就remove embed HTTP support</p>
<pre class=" language-bash"><code class="language-bash">Version 4.05  2012-12-30
 * client/fdfs_upload_file.c can specify storage ip port and store path index
 * add connection pool
 * client load storage ids config
 * common/ini_file_reader.c does NOT call chdir
 * keep the mtime of <span class="token function">file</span> same
 * use g_current_time instead of call <span class="token function">time</span> <span class="token keyword">function</span>
 * remove embed HTTP support
</code></pre>
<p>HTTP请求不能访问文件的原因</p>
<blockquote>
<p>我们在使用FastDFS部署一个分布式文件系统的时候，通过FastDFS的客户端API来进行文件的上传、下载、删除等操作。同时通过FastDFS的HTTP服务器来提供HTTP服务。但是FastDFS的HTTP服务较为简单，无法提供负载均衡等高性能的服务，所以FastDFS的开发者——淘宝的架构师余庆同学，为我们提供了Nginx上使用的FastDFS模块（也可以叫FastDFS的Nginx模块）。<br>FastDFS通过Tracker服务器,将文件放在Storage服务器存储,但是同组之间的服务器需要复制文件,有延迟的问题.假设Tracker服务器将文件上传到了120.<strong>.</strong>.165,文件ID已经返回客户端,这时,后台会将这个文件复制到120.<strong>.</strong>.1651,如果复制没有完成,客户端就用这个ID在120.<strong>.</strong>.165取文件,肯定会出现错误。这个fastdfs-nginx-module可以重定向连接到源服务器取文件,避免客户端由于复制延迟的问题,出现错误。<br>正是这样，FastDFS需要结合nginx，所以取消原来对HTTP的直接支持。</p>
</blockquote>
<h2 id="FastDFS的nginx模块安装"><a href="#FastDFS的nginx模块安装" class="headerlink" title="FastDFS的nginx模块安装"></a>FastDFS的nginx模块安装</h2><h3 id="配置storage-nginx"><a href="#配置storage-nginx" class="headerlink" title="配置storage nginx"></a>配置storage nginx</h3><p>准备nginx安装</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /var/fdfs
</code></pre>
<p>在安装nginx之前要安装nginx所需的依赖lib:</p>
<pre class=" language-bash"><code class="language-bash">yum -y <span class="token function">install</span> pcre pcre-devel  
yum -y <span class="token function">install</span> zlib zlib-devel  
yum -y <span class="token function">install</span> openssl openssl-devel
</code></pre>
<p>安装nginx并添加fastdfs-nginx-module<br>解压nginx,和fastdfs-nginx-module:</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf nginx-1.12.0.tar.gz
unzip fastdfs-nginx-module-master.zip
</code></pre>
<p>然后进入nginx安装目录，添加fastdfs-nginx-module：</p>
<pre class=" language-bash"><code class="language-bash">./configure --prefix<span class="token operator">=</span>/usr/local/nginx \
--add-module<span class="token operator">=</span>/var/fdfs/fastdfs-nginx-module-master/src    
</code></pre>
<blockquote>
<p>注意，这里有个坑！一开始对nginx的插件安装并不了解，使用的是yum下载的nginx，这样下载后的nginx好像是自带了某些插件，不需要配置SSL(因为博主的博客使用nginx做的静态代理，并且使用了SSL加密)。然而！从官网下载的nginx并不带有这个插件，所有导致博主在编译的时候一直报错。因为nginx的插件是批量添加的，所以，如果配置了HTTPS代理，那么就需要按如下方式配置两个插件！</p>
<pre class=" language-bash"><code class="language-bash">./configure --prefix<span class="token operator">=</span>/usr/local/nginx \
--with-http_ssl_module \
--add-module<span class="token operator">=</span>/var/fdfs/fastdfs-nginx-module-master/src 
</code></pre>
<p>如果没有错误信息，开始安装</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span>
</code></pre>
<p>这里还有个坑！<code>make</code>编译的时候可能会报这个错<code>/usr/include/fastdfs/fdfs_define.h:15:27: fatal error: common_define.h: No such file or directory</code>。<br>下面给出解决方案：<br>修改fastdfs-nginx-module-1.20/src/config文件，并且重新配置一次./configure<br>ngx_module_incs=<code>&quot;/usr/include/fastdfs /usr/include/fastcommon/&quot;</code><br>CORE_INCS=<code>&quot;$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/&quot;</code><br>配置完毕后再次./configure后进行make。<br>nginx的默认目录是/usr/local/nginx 开始 配置storage nginx</p>
<pre class=" language-bash"><code class="language-bash">root@izwz9hx50rbasf6sqasl7vz nginx-1.12.0<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /usr/local/nginx</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz nginx<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll</span>
</code></pre>
<p>修改nginx.conf:</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz nginx<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd conf/</span>
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz conf<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
fastcgi.conf            koi-win             scgi_params
fastcgi.conf.default    mime.types          scgi_params.default
fastcgi_params          mime.types.default  uwsgi_params
fastcgi_params.default  nginx.conf          uwsgi_params.default
koi-utf                 nginx.conf.default  win-utf
<span class="token punctuation">[</span>root@izwz9hx50rbasf6sqasl7vz conf<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vi nginx.conf</span>
</code></pre>
<p>修改listen 9999.然后 新增本地location<br><code>`</code>bash<br>server {<br>        listen       9999;<br>        server_name  localhost;</p>
</blockquote>
<pre><code>    location / {
        root   html;
        index  index.html index.htm;
    }

    location /group1/M00 {
        root /var/fastdfs/fastdfs_storage_data/data;
        ngx_fastdfs_module;
    }
}
</code></pre><pre><code>然后进入FastDFS安装时的解压过的目录
```bash
[root@izwz9hx50rbasf6sqasl7vz fastdfs-5.11]# cd /var/fdfs/fastdfs-5.11/conf
[root@izwz9hx50rbasf6sqasl7vz conf]# ls
anti-steal.jpg  http.conf   storage.conf      tracker.conf
client.conf     mime.types  storage_ids.conf
</code></pre><p>将http.conf和mime.types拷贝到/etc/fdfs目录下</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cp</span> http.conf /etc/fdfs/
<span class="token function">cp</span> mime.types /etc/fdfs/
</code></pre>
<p>另外还需要把fastdfs-nginx-module安装目录中src目录下的mod_fastdfs.conf也拷贝到/etc/fdfs目录下：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cp</span> /var/fdfs/fastdfs-nginx-module-master/src/mod_fastdfs.conf /etc/fdfs/
</code></pre>
<p>对刚刚拷贝的mod_fastdfs.conf文件进行修改：</p>
<pre class=" language-bash"><code class="language-bash">vim /etc/fdfs/mod_fastdfs.conf

base_path<span class="token operator">=</span>/var/fastdfs/fastdfs_storage  <span class="token comment" spellcheck="true">#保存日志目录</span>
tracker_server<span class="token operator">=</span>120.**.***.165:22122 <span class="token comment" spellcheck="true">#tracker服务器的IP地址以及端口号</span>
storage_server_port<span class="token operator">=</span>23000 <span class="token comment" spellcheck="true">#storage服务器的端口号</span>
url_have_group_name <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment" spellcheck="true">#文件 url 中是否有 group 名</span>
store_path0<span class="token operator">=</span>/var/fastdfs/fastdfs_storage_data   <span class="token comment" spellcheck="true">#存储路径</span>
group_count <span class="token operator">=</span> 3 <span class="token comment" spellcheck="true">#设置组的个数，事实上这次只使用了group1</span>
</code></pre>
<p>在文件的最后，设置group</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>group1<span class="token punctuation">]</span>
group_name<span class="token operator">=</span>group1
storage_server_port<span class="token operator">=</span>23000
store_path_count<span class="token operator">=</span>1
store_path0<span class="token operator">=</span>/var/fastdfs/fastdfs_storage_data
store_path1<span class="token operator">=</span>/var/fastdfs/fastdfs_storage_data

<span class="token comment" spellcheck="true"># group settings for group #2</span>
<span class="token comment" spellcheck="true"># since v1.14</span>
<span class="token comment" spellcheck="true"># when support multi-group, uncomment following section as neccessary</span>
<span class="token punctuation">[</span>group2<span class="token punctuation">]</span>
group_name<span class="token operator">=</span>group2
storage_server_port<span class="token operator">=</span>23000
store_path_count<span class="token operator">=</span>1
store_path0<span class="token operator">=</span>/var/fastdfs/fastdfs_storage_data

<span class="token punctuation">[</span>group3<span class="token punctuation">]</span>
group_name<span class="token operator">=</span>group3
storage_server_port<span class="token operator">=</span>23000
store_path_count<span class="token operator">=</span>1
store_path0<span class="token operator">=</span>/var/fastdfs/fastdfs_storage_dat
</code></pre>
<p>创建M00至storage存储目录的符号连接：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">ln</span>  -s  /var/fastdfs/fastdfs_storage_data/data/ /var/fastdfs/fastdfs_storage_data/data/M00
</code></pre>
<p>启动nginx:</p>
<pre class=" language-bash"><code class="language-bash">/usr/local/nginx/sbin/nginx
</code></pre>
<p>成功启动：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost conf<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># /usr/local/nginx/sbin/nginx</span>
ngx_http_fastdfs_set pid<span class="token operator">=</span>1231
</code></pre>
<p><img src="https://s2.ax1x.com/2019/04/04/A2DAvF.png" alt=""><br>恭喜你，storage的nginx已配置成功。接下来，我们还要继续配置tracker的nginx。  </p>
<h3 id="配置tracker-nginx"><a href="#配置tracker-nginx" class="headerlink" title="配置tracker nginx"></a>配置tracker nginx</h3><p>一样的还是修改nginx.conf。需将upstream指向tracker的nginx地址。</p>
<pre class=" language-bash"><code class="language-bash">vim /usr/local/nginx/conf/nginx.conf

 upstream fdfs_group1 <span class="token punctuation">{</span>
        server 127.0.0.1:9999<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    server <span class="token punctuation">{</span>
        listen       9989<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">#charset koi8-r;</span>

        <span class="token comment" spellcheck="true">#access_log  logs/host.access.log  main;</span>

        location /group1/M00 <span class="token punctuation">{</span>
            proxy_pass http://fdfs_group1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>重新加载nginx的配置文件:</p>
<pre><code>[root@localhost conf]# /usr/local/nginx/sbin/nginx -s reload
</code></pre><p><img src="https://s2.ax1x.com/2019/04/04/A2Deb9.png" alt=""><br>如果 访问不了 那就修改防火墙吧(阿里服务器上请不要随意关闭防火墙，可能是安全组没有打开！)</p>
<pre class=" language-bash"><code class="language-bash">firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>23000/tcp --permanent <span class="token comment" spellcheck="true">#开户端口号</span>
</code></pre>
<p>或者</p>
<pre class=" language-bash"><code class="language-bash">systemctl <span class="token function">enable</span> firewalld.service <span class="token comment" spellcheck="true">#开启防火墙</span>
systemctl stop firewalld.service  <span class="token comment" spellcheck="true">#关闭防火墙(开机会仍会启动)</span>
systemctl disable firewalld.service  <span class="token comment" spellcheck="true">#禁用防火墙(开机后不再启动)</span>
</code></pre>
<p>然后在找刚才那个路径 测试<br><img src="https://s2.ax1x.com/2019/04/04/A2D9Nq.png" alt=""><br>OK，到此已经结束，大功告成\~</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul>
<li>本篇博客基于网上很多资料完成，按照流程搭建下来不会报错。但碍于linux环境的复杂多样，如果遇到未知错误，请多耐心查找原因(百度是个好东西！)。当然也可以联系博主~博主有时间会解答的噢。</li>
<li>FastDFS的Java客户端，<a href="https://chihiro.org.cn/blogs/504695146.html">点我达~</a></li>
</ul>

            </div>
            <hr>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="https://chihiro.org.cn" class="b-link-green">千与千寻</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/blogs/4286120219.html" class="b-link-green">FastDFS-Nginx分布式文件系统搭建</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'L6269QB54HyvOTIorxQBjuJV-gzGzoHsz',
        appKey: '9J17Q1nkElcIBozc7hywMTrD',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '来个评论助助兴吧~'
    });
</script>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/blogs/504695146.html">
                    <div class="card-image">
                        
                        <img src="https://s2.ax1x.com/2019/04/08/A4Hu9I.png" class="responsive-img" alt="FastDFS的Java客户端">
                        
                        <span class="card-title">FastDFS的Java客户端</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            分布式文件服务器FastDFS的Java客户端。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-04-08
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/后端/" class="post-category" target="_blank">
                                    后端
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/" target="_blank">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/FastDFS/" target="_blank">
                        <span class="chip bg-color">FastDFS</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/blogs/157566173.html">
                    <div class="card-image">
                        
                        <img src="https://s2.ax1x.com/2019/03/31/AD74ij.jpg" class="responsive-img" alt="Java面向对象设计之适配器模式">
                        
                        <span class="card-title">Java面向对象设计之适配器模式</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            适配器模式介绍及使用。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-03-31
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/软件编程/" class="post-category" target="_blank">
                                    软件编程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/" target="_blank">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/设计模式/" target="_blank">
                        <span class="chip bg-color">设计模式</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>


<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            本站由&copy;<a href="https://chihiro.org.cn/" target="_blank" rel="external nofollow">Chihiro</a>基于
            <a href="https://blinkfox.github.io/" target="_blank" rel="external nofollow noopener noreferrer">Blinkfox</a> 的
            <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="external nofollow noopener noreferrer">hexo-theme-matery</a>主题搭建.&nbsp;
            
                <i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">44.1k</span>&nbsp;
            
	    <span class="white-color"><a href="https://996.icu" target="_blank" style="color: white;font-size: 15px;" rel="external nofollow noopener noreferrer"><img src="https://img.shields.io/badge/link-996.icu-red.svg" alt="996.icu" border="0"></a></span><br>
	    <span class="white-color"><a href="http://www.beian.miit.gov.cn" target="_blank" style="color: white;font-size: 15px;" rel="external nofollow noopener noreferrer">粤ICP备19022950号</a></span>&nbsp;&nbsp;
	    <span class="white-color"><img src="https://s2.ax1x.com/2019/08/06/ef5scn.png" alt="ef5scn.png" border="0"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030902001616" target="_blank" style="color: white;font-size: 15px;" rel="external nofollow noopener noreferrer">粤公网安备 44030902001616号</a></span>&nbsp;&nbsp;
	    
		<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1276506987'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s96.cnzz.com/z_stat.php%3Fid%3D1276506987%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
	    
        </div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->



    <script src="/libs/others/clicklove.js"></script>


    <script async src="/libs/others/busuanzi.pure.mini.js"></script>


<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>